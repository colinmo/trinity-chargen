<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <meta name="author" content="Colin Morris">
    <title>Trinity Character Engine</title>
    <link href="https://fonts.cdnfonts.com/css/futura-windows" rel="stylesheet">
    <style>
        :root {
            --shade-color: rgba(0, 0, 0, 0.3);
            --shade-text: white;
            --table-alt-color: #fff;
            --table-alt-text: #000;
            --border-color: #f0f000;
            --background: white;

            --talent-background: #d8a28f;
            --talent-text: black;

            --nova-background: black;
            --nova-text: #ffbd00;

            --psion-background: #b90016;
            --psion-text: white;

            --inspired-background: #e5a08d;
            --inspired-text: black;
            --title-img: url(img/talent.png);
            --title-img-height: 168px;
        }

        @media screen and (min-width:70em) {
            main {
                margin: 0 auto;
                max-width: 70em;
            }
        }

        html {
            font-family: 'Futura Windows', sans-serif;
        }

        fieldset {
            padding: 20px;
        }

        #class-of-char label {
            font-size: 3em;
            border: thin solid brown;
            border-radius: 20px;
            padding: 10px;
            margin: 10px 10px;
            display: inline-block;
            width: 8em;
            text-align: center;
        }

        input#talent:checked~form {
            --shade-color: #a5181c;
            --shade-text: white;
            --table-alt-color: #f0ded6;
            --table-alt-text: var(--talent-text);
            --border-color: #d8a28f;
            --background: lightgrey;
            --title-img: url(img/talent.png);
            --title-img-height: 168px;
        }

        #class-of-char label[for=talent] {
            background: var(--talent-background);
            color: var(--talent-text);
            border-color: var(--talent-text);
        }

        input#nova:checked~form {
            --shade-color: var(--nova-background);
            --shade-text: var(--nova-text);
            --table-alt-color: #e5a08d;
            --table-alt-text: black;
            --border-color: #ffdccd;
            --title-img: url(img/aberrant.png);
            --title-img-height: 186px;
        }

        #class-of-char label[for=nova] {
            background: var(--nova-background);
            color: var(--nova-text);
            border-color: var(--nova-text);
        }


        input#psion:checked~form {
            --shade-color: #b90016;
            --shade-text: white;
            --table-alt-color: var(--psion-background);
            --table-alt-text: var(--psion-text);
            --border-color: #e5a08d;
            --title-img: url(img/aeon.png);
            --title-img-height: 181px;
        }

        #class-of-char label[for=psion] {
            background: var(--psion-background);
            color: var(--psion-text);
            border-color: var(--psion-text);
        }

        input#inspired:checked~form {
            --shade-color: linear-gradient(90deg, rgba(245, 89, 0, 1) 0%, rgba(235, 0, 35, 1) 15%, rgba(235, 0, 35, 1) 85%, rgba(245, 89, 0, 1) 100%);
            --shade-text: white;
            --border-color: var(--inspired-background);
            --table-alt-color: #f5ddd5;
            --title-img: url(img/adventure.png);
            --title-img-height: 230px;
        }

        #class-of-char label[for=inspired] {
            background: var(--inspired-background);
            color: var(--inspired-text);
            border-color: var(--inspired-text);
        }

        #generation.tabbed-interface>fieldset {
            display: none;
        }

        input#class:checked~form fieldset#class-of-char,
        input#basics:checked~form fieldset#basics-for-char,
        input#paths:checked~form fieldset#path-selection,
        input#skills:checked~form fieldset#skill-selection,
        input#attributes:checked~form fieldset#attribute-selection,
        input#extras:checked~form fieldset#extra-selection,
        input#template:checked~form fieldset#template-selection,
        input#sheet:checked~form fieldset#character-sheet {
            display: block;
        }

        input#class:checked~form label[for=class],
        input#basics:checked~form label[for=basics],
        input#paths:checked~form label[for=paths],
        input#skills:checked~form label[for=skills],
        input#attributes:checked~form label[for=attributes],
        input#extras:checked~form label[for=extras],
        input#template:checked~form label[for=template],
        input#sheet:checked~form label[for=sheet] {
            background: green;
        }

        input#talent:checked~form label[for=talent],
        input#psion:checked~form label[for=psion],
        input#nova:checked~form label[for=nova],
        input#inspired:checked~form label[for=inspired] {
            cursor: pointer;
            font-weight: bold;
            text-decoration: underline solid 3px;
        }

        div.talent,
        div.psion,
        div.nova,
        div.inspired {
            display: none;
        }

        input#talent:checked~form div.talent,
        input#psion:checked~form div.psion,
        input#nova:checked~form div.nova,
        input#inspired:checked~form div.inspired {
            display: block;
        }

        #class-of-char input:not(:checked)+span {
            cursor: pointer;
            font-weight: lighter;
        }

        #class-of-char input:not(:checked)+span:hover {
            cursor: pointer;
            font-weight: inherit;
        }

        * {
            box-sizing: border-box;
        }

        /* Dot selectors */
        div.skill-and-dots {
            display: grid;
            grid-template-columns: 7em 1fr 8em;
            grid-template-areas: "header name dots";
            column-gap: 3px;
        }

        div.skill-and-dots label {
            grid-area: header;
        }

        div.skill-and-dots>repeat-selector,
        div.skill-and-dots>type-and-select,
        div.skill-and-dots>.custom-combobox {
            grid-area: name;
        }

        div.skill-and-dots>dot-selector {
            grid-area: dots;
        }

        div.just-skill {
            display: grid;
            grid-template-columns: 7em 1fr;
            grid-template-areas: "header name";
            column-gap: 3px;
        }

        div.just-skill label {
            grid-area: header;
        }

        div.just-skill type-and-select,
        div.just-skill textarea {
            grid-area: name;
        }

        nav label,
        nav.buttons a {
            display: inline-block;
            font-weight: bold;
            background: #000;
            border-radius: 4px;
            font-size: 14px;
            color: #FFF;
            padding: 8px 12px;
            cursor: pointer;
            text-decoration: none;
        }
    </style>

    <script>
        var filledCircle = `&#x25C9;`,
            emptyCircle = `&#x25EF;`;
        class DotSelector extends HTMLElement {
            constructor() {
                super();

                // Known attributes
                this.name = "";
                this.max = 5;
                this.min = 0;
                this.default = 0;
                this.value = 0;

                // Add to the Formdata event so
                // the form can access the values
                const form = document.querySelector('form');
                form.addEventListener('formdata', ({ formData }) => {
                    formData.append(this.name, this.value);
                })
            }

            static get observedAttributes() {
                // These attributes will be monitored for
                // changes in the DOM
                return ['max', 'min', 'default', 'value', "name"]
            }

            attributeChangedCallback(property, oldValue, newValue) {
                // Called when a property changes
                // This just sets the local property to the new one
                if (oldValue === newValue) return;
                this[property] = newValue;
                if (property == "value" && this.value < this.min) {
                    this.value = this.min;
                }
            }

            connectedCallback() {
                // Once this is instantiated, create the 
                // select object
                let thisSelect = document.createElement("SELECT"),
                    maxPlus1 = parseInt(this.max, 10) + 1;
                thisSelect.name = this.name;
                for (let i = this.min; i < maxPlus1; i++) {
                    let thisOption = document.createElement("OPTION")
                    thisOption.value = i;
                    thisOption.selected = (i == this.current) ? " selected" : "";
                    thisOption.innerHTML = filledCircle.repeat(i) + emptyCircle.repeat(this.max - i);
                    thisSelect.appendChild(thisOption)
                }

                // This is needed to set this object's value
                // to what it was changed to in the attribute
                thisSelect.onchange = (x) => {
                    this.value = x.target.value;
                }

                // Set the HTML for the custom element
                // to this new select + event
                this.innerHTML = "";
                this.appendChild(thisSelect)

            }
        }
        customElements.define('dot-selector', DotSelector);

        class DotLabel extends HTMLElement {
            constructor() {
                super();

                // Known attributes
                this.name = "";
                this.value = 0;
                this.max = 5;
            }

            static get observedAttributes() {
                // These attributes will be monitored for
                // changes in the DOM
                return ['value', "name", "max"]
            }

            attributeChangedCallback(property, oldValue, newValue) {
                // Called when a property changes
                // This just sets the local property to the new one
                if (oldValue === newValue) return;
                this[property] = newValue;
                this.connectedCallback()
            }

            connectedCallback() {
                // Initial values
                this.style.display = "grid";
                this.style.gridTemplateColumns = "auto auto";

                const maxPlus1 = this.value == 10 ? 10 : 5;
                if (this.innerHTML == "") {
                    this.innerHTML = `<span class="label"></span><span class="value"></span>`;
                }
                this.querySelector('.label').innerText = this.name;
                this.querySelector('.label').style = "display: grid";
                this.querySelector('.value').innerHTML = filledCircle.repeat(this.value) + emptyCircle.repeat(maxPlus1 - this.value);
                this.querySelector('.value').style = "display:grid;justify-content: end;";
            }
        }
        customElements.define('dot-label', DotLabel);

        class RepeatSelector extends HTMLElement {
            constructor() {
                super();

                // Known attributes
                this.name = "";
                this.options = [];
                this.displayed = [];
                this.default = "";
                this.value = "";
                this.id2 = "";
                this.select = document.createElement("SELECT");

                // Add to the formdata
                const form = document.querySelector('form');
                form.addEventListener('formdata', ({ formData }) => {
                    formData.append(this.name, this.value);
                })
            }

            setupOptions(theseOptions) {
                this.select.innerHTML = "";
                this.select.appendChild(document.createElement("OPTION"));
                theseOptions.forEach((e) => {
                    let thisOption = document.createElement("OPTION");
                    thisOption.value = e;
                    thisOption.selected = (e == this.default) ? " selected" : "";
                    thisOption.innerText = e;
                    this.select.appendChild(thisOption);
                });
            }
            static get observedAttributes() {
                return ['name', 'options', 'value', 'default', 'id2', 'displayed'];
            }

            attributeChangedCallback(property, oldValue, newValue) {
                if (oldValue == newValue) return;
                if (property == "options") {
                    this.options = newValue.split("|")
                    this.setupOptions(this.options);
                } else if (property == "displayed") {
                    console.log('changed displayed')
                    if (newValue == null) {
                        this.setupOptions(this.options);
                        this.select.disabled = false;
                    } else {
                        this.displayed = newValue.split("|");
                        this.setupOptions(this.displayed);
                        if (this.displayed.length == 1) {
                            this.value = this.displayed[0];
                            this.select.value = this.displayed[0];
                            this.select.disabled = true;
                        }
                    }
                } else {
                    this[property] = newValue;
                }
            }

            connectedCallback() {
                this.select.appendChild(document.createElement("OPTION"));
                this.select.name = this.name;
                this.select.id = this.id2;
                this.select.setAttribute("style", "width:100%;");
                this.setupOptions(this.options);
                this.select.onChange = (x) => {
                    this.value = x.target.value;
                }

                this.innerHTML = "";
                this.appendChild(this.select);
            }
        }
        customElements.define('repeat-selector', RepeatSelector);

        class TypeAndSelect extends HTMLElement {

            constructor() {
                super();

                // Known attributes
                this.name = "";
                this.options = [];
                this.default = "";
                this.value = "";
                this.id2 = "";
                this.select = document.createElement("SELECT");

                // Add to the formdata
                const form = document.querySelector('form');
                form.addEventListener('formdata', ({ formData }) => {
                    formData.append(this.name, this.value);
                })
            }

            static get observedAttributes() {
                return ['name', 'options', 'value', 'default', 'id2'];
            }
            setupOptions() {
                this.select.innerHTML = "";
                let thisOption = document.createElement("OPTION");
                thisOption.value = "";
                thisOption.selected = ("" == this.default) ? " selected" : "";
                thisOption.innerText = "";
                this.select.appendChild(thisOption);
                this.options.forEach((e) => {
                    let thisOption = document.createElement("OPTION");
                    thisOption.value = e;
                    thisOption.selected = (e == this.default) ? " selected" : "";
                    thisOption.innerText = e;
                    this.select.appendChild(thisOption);
                });
            }
            attributeChangedCallback(property, oldValue, newValue) {
                if (oldValue == newValue) return;
                switch (property) {
                    case 'options':
                        this['options'] = newValue.split("|")
                        this.setupOptions();
                        break;
                    case 'value':
                        console.log(`Setting ${property} as ${newValue} ; was ${oldValue}`)
                        this['value'] = newValue;
                        console.log(this.name, this.value, this);
                        break;
                    default:
                        this[property] = newValue;
                }
            }

            filterSelect() {
                var hint = this.value;
                if (this.value = "") {
                    this.select.style.display = "none";
                } else {
                    var foundCount = false;
                    hint = hint.toLowerCase();
                    for (let i = 0; i < this.select.options.length; i++) {
                        const me = this.select.options[i];
                        const matche = (me?.value ?? "").toLowerCase();
                        if (matche.indexOf(hint) > -1) {
                            me.style.display = "";
                            foundCount = true;
                        } else {
                            me.style.display = "none";
                        }
                    };
                    if (foundCount) {
                        this.select.style.display = "";
                    } else {
                        this.select.style.display = "none";
                    }
                }
            }
            connectedCallback() {
                let thisText = document.createElement("INPUT");
                thisText.name = this.name;
                thisText.id = this.id2;
                thisText.type = "text";
                thisText.setAttribute("style", "width:100%;")
                thisText.addEventListener("input", (x) => {
                    console.log(`Filter ${x.target.value}`)
                    thisText.value = x.target.value;
                    this.setAttribute("value", x.target.value);
                    this.filterSelect();
                });

                this.select.name = this.name + "_s";
                this.select.id = this.id2 + "_s";
                this.select.size = "10";
                this.select.setAttribute("style", "width:100%;display:none;");
                this.select.addEventListener("change", (x) => {
                    console.log(`Setting my value ${x.target.value}`);
                    thisText.value = x.target.value;
                    this.setAttribute("value", x.target.value);
                })

                this.innerHTML = "";
                this.appendChild(thisText);
                this.appendChild(this.select);
                this.setAttribute('tabindex', 0);
                this.addEventListener("blur", (x) => { console.log("Blurred") });
            }
        }
        customElements.define('type-and-select', TypeAndSelect);

        class AlertBar extends HTMLElement {
            constructor() {
                super();

                this.name = "";
                this.message = "";
            }

            static get observedAttributes() {
                return ['name', 'message'];
            }

            attributeChangedCallback(property, oldValue, newValue) {
                if (oldValue == newValue) return;
                this[property] = newValue;
            }

            connectedCallback() {
                this.setAttribute("style", "");
                this.innerHTML = this.message;
            }
        }
        customElements.define('alert-bar', AlertBar);
    </script>
</head>

<body>
    <style>
        .button-bar {
            display: flex;
        }

        .button-bar a {
            display: inline-block;
            text-align: center;
            position: relative;
            width: 2.5em;
            border: none;
            text-decoration: none;
            margin: 0;
            padding: 3px;
            border: 5px groove black;
            background: grey;
        }

        a[aria-label="Save"]::after {
            content: "\ffea";
            position: absolute;
            top: 6px;
            left: 0.7em;
            font-weight: bold;
        }

        details summary::-webkit-details-marker,
        details summary::marker {
            display: none;
        }

        details>summary {
            list-style: none;
            text-align: right;
        }

        fieldset {
            position: relative;
        }

        fieldset legend span {
            position: absolute;
            right: 0;
        }

        fieldset legend span alert-bar {
            padding: 0 5px;
            border: thin solid black;
            background: black;
            color: white;
            border-radius: 5px;
        }
    </style>
    <main id="trinity" class="panel">

        <header>
            <h1 class="p-name">Trinity character creator</h1>
            <!--<nav class="button-bar disabled">
                <a href="#" aria-label="New character">&#x1F195;</a>
                <a href="#" aria-label="Load">&#x1F4C1;</a>
                <a href="#" aria-label="Save">&#x1f4be;</a>
            </nav>-->
        </header><!--
        <section id="introduction">
            <h2>Introduction</h2>
                <p>INTRODUCTION TEXT</p>
        </section>
    -->
        <input type="radio" style="visibility:hidden;" name="tabopen" id="class">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="basics">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="paths">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="skills">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="attributes">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="template">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="extras">
        <input type="radio" style="visibility:hidden;" name="tabopen" id="sheet">
        <input type="radio" style="visibility:hidden;" name="charclass" id="talent" value="Talent" />
        <input type="radio" style="visibility:hidden;" name="charclass" id="psion" value="Psion" />
        <input type="radio" style="visibility:hidden;" name="charclass" id="nova" value="Nova" />
        <input type="radio" style="visibility:hidden;" name="charclass" id="inspired" value="Inspired" />
        <form id="generation" class="tabbed-interface">
            <nav>
                <label for="class">Class</label>
                <label for="basics">Concept</label>
                <label for="paths">Paths</label>
                <label for="skills">Skills</label>
                <label for="attributes">Attributes</label>
                <label for="template">Template</label>
                <label for="extras">Final touches</label>
                <label for="sheet">Character sheet</label>
            </nav>
            <fieldset id="class-of-char">
                <legend>Character type</legend>
                <details>
                    <summary>&#x24D8;</summary>
                    <p>Ideas</p>
                    <ul>
                        <li>Have character sheet in an extra window or able to be a beside tab to show the character as
                            its
                            created.</li>
                        <li>Save user preferences (e.g. have character sheet as a tab, or beside, or other window).</li>
                    </ul>
                </details>
                <label for="talent"><span>Talent</span></label>
                <label for="psion"><span>Psion</span></label>
                <label for="nova"><span>Nova</span></label>
                <label for="inspired"><span>Inspired</span></label>
                <hr />
                <a href="javascript:character.updateCharacter();character.updateCharacterSheet()" />Update Character</a>
            </fieldset>
            <fieldset id="basics-for-char">
                <legend>Basics</legend>
                <div class="just-skill">
                    <label for="name" id="label_name">Name</label>
                    <input type="text" id="name" name="name" value="">
                </div>
                <div class="just-skill">
                    <label for="player" id="label_player">Player</label>
                    <input type="text" id="player" name="player" value="">
                </div>
                <div class="just-skill">
                    <label for="concept" id="label_concept">Concept/ RP Tips</label>
                    <input type="text" id="concept" name="concept" value="">
                </div>
                <div class="just-skill">

                    <label for="aspiration_short_1">Short aspiration (1)</label>
                    <input type="text" t="" id="aspiration_short_1" name="aspiration_short_1" value="">
                </div>
                <div class="just-skill">
                    <label for="aspiration_short_2">Short aspiration (2)</label>
                    <input type="text" id="aspiration_short_2" name="aspiration_short_2" value="">
                </div>
                <div class="just-skill">
                    <label for="aspiration_long">Long aspiration</label>
                    <textarea id="aspiration_long" name="aspiration_long"></textarea>
                </div>
            </fieldset>
            <fieldset id="path-selection">
                <legend>Paths</legend>
                <fieldset id="origin">
                    <legend>Origin
                        <span>
                            <alert-bar name="origin-skill-points" message="3 skill points left"></alert-bar>
                            <alert-bar name="origin-edge-points" message="2 edge points left"></alert-bar>
                        </span>
                    </legend>
                    <div class="just-skill">
                        <label for="origin_path">Path</label>
                        <input list="origin_paths" name="origin_path" id="origin_path">
                        <datalist id="origin_paths">
                            <option value="Aeon Trinity" data-skills="Aim|Pilot|Combat|Command">
                            <option value="Lamplighters" data-skills="Larceny|Pilot|Science|Survival">
                        </datalist>
                    </div>
                    </style>
                    <div class="skill-and-dots">
                        <label for="origin_skill_1_name">Skill (1)</label>
                        <repeat-selector name="origin_skill_1_name" id2="origin_skill_1_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="origin_skill_1_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="origin_skill_2_name">Skill (2)</label>
                        <repeat-selector name="origin_skill_2_name" id2="origin_skill_2_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="origin_skill_2_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="origin_skill_3_name">Skill (3)</label>
                        <repeat-selector name="origin_skill_3_name" id2="origin_skill_3_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="origin_skill_3_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="origin_skill_4_name">Skill (4)</label>
                        <repeat-selector name="origin_skill_4_name" id2="origin_skill_4_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="origin_skill_4_value" max="5"></dot-selector>
                    </div>
                    <div class="just-skill">
                        <label for="origin_gca">Group, contact and access connections</label>
                        <textarea id="origin_gca" name="origin_gca"></textarea>
                    </div>
                    <div class="skill-and-dots">
                        <label for="origin_edge_1">Edge (1)</label>
                        <type-and-select name="origin_edge_1_name" id2="origin_edge_1_name" default=""
                            options="One|Two"></type-and-select>
                        <dot-selector name="origin_edge_1_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="origin_edge_2_name">Edge (2)</label>
                        <type-and-select name="origin_edge_2_name" id2="origin_edge_2_name" default=""
                            options="One|Two"></type-and-select>
                        <dot-selector name="origin_edge_2_value" max="5"></dot-selector>
                    </div>
                    <div class="just-skill">
                        <label for="origin_path_condition">Path condition</label>
                        <input type="text" id="origin_path_condition" name="origin_path_condition" value="">
                    </div>
                </fieldset>
                <fieldset id="role">
                    <legend>Role
                        <span>
                            <alert-bar name="role-skill-points" message="3 skill points left"></alert-bar>
                            <alert-bar name="role-edge-points" message="2 edge points left"></alert-bar>
                        </span>
                    </legend>
                    <div class="just-skill">
                        <label for="role_path">Path</label>
                        <input list="role_paths" name="role_path" id="role_path">
                        <datalist id="role_paths">
                            <option value="Diplomat" data-skills="Aim|Pilot|Combat|Command">
                            <option value="Researcher" data-skills="Larceny|Pilot|Science|Survival">
                        </datalist>
                    </div>
                    </style>
                    <div class="skill-and-dots">
                        <label for="role_skill_1_name">Skill (1)</label>
                        <repeat-selector name="role_skill_1_name" id2="role_skill_1_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="role_skill_1_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="role_skill_2_name">Skill (2)</label>
                        <repeat-selector name="role_skill_2_name" id2="role_skill_2_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="role_skill_2_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="role_skill_3_name">Skill (3)</label>
                        <repeat-selector name="role_skill_3_name" id2="role_skill_3_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="role_skill_3_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="role_skill_4_name">Skill (4)</label>
                        <repeat-selector name="role_skill_4_name" id2="role_skill_4_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="role_skill_4_value" max="5"></dot-selector>
                    </div>
                    <div class="just-skill">
                        <label for="role_gca">Group, contact and access connections</label>
                        <textarea id="role_gca" name="role_gca"></textarea>
                    </div>
                    <div class="skill-and-dots">
                        <label for="role_edge_1">Edge (1)</label>
                        <type-and-select name="role_edge_1_name" id2="role_edge_1_name" default=""
                            options="One|Two"></type-and-select>
                        <dot-selector name="role_edge_1_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="role_edge_2_name">Edge (2)</label>
                        <type-and-select name="role_edge_2_name" id2="role_edge_2_name" default=""
                            options="One|Two"></type-and-select>
                        <dot-selector name="role_edge_2_value" max="5"></dot-selector>
                    </div>
                    <div class="just-skill">
                        <label for="role_path_condition">Path condition</label>
                        <input type="text" id="role_path_condition" name="role_path_condition" value="">
                    </div>
                </fieldset>
                <fieldset id="society">
                    <legend>Society
                        <span>
                            <alert-bar name="society-skill-points" message="3 skill points left"></alert-bar>
                            <alert-bar name="society-edge-points" message="2 edge points left"></alert-bar>
                        </span>
                    </legend>
                    <div class="just-skill">
                        <label for="society_path">Path</label>
                        <input list="society_paths" name="society_path" id="society_path">
                        <datalist id="society_paths">
                            <option value="Diplomat" data-skills="Aim|Pilot|Combat|Command">
                            <option value="Researcher" data-skills="Larceny|Pilot|Science|Survival">
                        </datalist>
                    </div>
                    </style>
                    <div class="skill-and-dots">
                        <label for="society_skill_1_name">Skill (1)</label>
                        <repeat-selector name="society_skill_1_name" id2="society_skill_1_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="society_skill_1_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="society_skill_2_name">Skill (2)</label>
                        <repeat-selector name="society_skill_2_name" id2="society_skill_2_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="society_skill_2_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="society_skill_3_name">Skill (3)</label>
                        <repeat-selector name="society_skill_3_name" id2="society_skill_3_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="society_skill_3_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="society_skill_4_name">Skill (4)</label>
                        <repeat-selector name="society_skill_4_name" id2="society_skill_4_name" default=""
                            options=""></repeat-selector>
                        <dot-selector name="society_skill_4_value" max="5"></dot-selector>
                    </div>
                    <div class="just-skill">
                        <label for="society_gca">Group, contact and access connections</label>
                        <textarea id="society_gca" name="society_gca"></textarea>
                    </div>
                    <div class="skill-and-dots">
                        <label for="society_edge_1">Edge (1)</label>
                        <type-and-select name="society_edge_1_name" id2="society_edge_1_name" default=""
                            options="One|Two"></type-and-select>
                        <dot-selector name="society_edge_1_value" max="5"></dot-selector>
                    </div>
                    <div class="skill-and-dots">
                        <label for="society_edge_2_name">Edge (2)</label>
                        <type-and-select name="society_edge_2_name" id2="society_edge_2_name" default=""
                            options="One|Two"></type-and-select>
                        <dot-selector name="society_edge_2_value" max="5"></dot-selector>
                    </div>
                    <div class="just-skill">
                        <label for="society_path_condition">Path condition</label>
                        <input type="text" id="society_path_condition" name="society_path_condition" value="">
                    </div>
                </fieldset>
            </fieldset>
            <script>
                document.querySelectorAll('input[list$="_paths"]').forEach((e) => {
                    e.addEventListener('input', (event) => {
                        let prefix = event.target.id.split("_")[0];
                        if (event.inputType == 'insertReplacementText') {
                            let existing = document.querySelector(`#${event.target.id} + datalist option[value="${event.data}"]`);
                            if (existing) {
                                let valuesToUse = existing.getAttribute('data-skills').split("|");
                                valuesToUse.forEach((e, i) => {
                                    let index = i + 1
                                    console.log(`${prefix}_skill_${index}_name`, e)
                                    document.querySelector(`repeat-selector[name="${prefix}_skill_${index}_name"]`).setAttribute('displayed', e);
                                })
                            }
                        } else {
                            for (index = 1; index < 5; index++) {
                                document.querySelector(`repeat-selector[name="${prefix}_skill_${index}_name"]`).removeAttribute('displayed');
                            }
                            console.log(event.inputType);
                        }
                        console.log(`${event.target.id}`);
                    });
                });
            </script>
            <fieldset id="skill-selection">
                <legend>Skills <alert-bar name="skill_points" message="6 skill points left"></alert-bar></legend>
                <div></div>
            </fieldset>
            <style>
                #attribute-layout {
                    display: grid;
                    grid-template-areas:
                        '. mental physical social'
                        'force intellect might presence'
                        'finesse cunning dexterity manipulation'
                        'resilience resolve stamina composure'
                        '. mental-end physical-end social-end';
                    grid-template-columns: 1fr 1fr 1fr 1fr;
                }

                #attribute-selection label.stat {
                    display: inline-grid;
                    grid-template-columns: 8em auto;
                }

                #attribute-selection label.check {
                    display: inline-grid;
                    grid-template-columns: 1em auto;
                }

                .check:nth-of-type(2n+4),
                .mental-column:nth-of-type(2n+5),
                .physical-column:nth-of-type(2n+4),
                .social-column:is(:nth-of-type(2n+5)) {
                    background: var(--table-alt-color);
                    color: var(--table-alt-text);
                }
            </style>
            <fieldset id="attribute-selection">
                <style>
                    label.stat.stattop {
                        border-top: thin solid var(--border-color);
                        padding-top: 5px;
                    }

                    label.stat,
                    div.statbottom {
                        border-left: thin solid var(--border-color);
                        border-right: thin solid var(--border-color);
                        padding: 0 5px;
                    }

                    div.statbottom {
                        border-bottom: thin solid var(--border-color);
                        height: 5px;
                    }
                </style>
                <legend>Attributes</legend>
                <div id="attribute-layout">
                    <label class="stat stattop mental-column" style="grid-area:mental"><select>
                            <option selected="selected">Primary</option>
                            <option>Secondary</option>
                            <option>Tertiary</option>
                        </select></label>
                    <label class="stat stattop physical-column" style="grid-area:physical"><select>
                            <option>Primary</option>
                            <option selected="selected">Secondary</option>
                            <option>Tertiary</option>
                        </select></label>
                    <label class="stat stattop social-column" style="grid-area:social"><select>
                            <option>Primary</option>
                            <option>Secondary</option>
                            <option selected="selected">Tertiary</option>
                        </select></label>
                    <label class="check" style="grid-area: force"><input type="checkbox" name="favoured_approach"
                            value="force" /><span>Force</span></label>
                    <label class="check" style="grid-area: finesse"><input type="checkbox" name="favoured_approach"
                            value="finesse" /><span>Finesse</span></label>
                    <label class="check" style="grid-area: resilience"><input type="checkbox" name="favoured_approach"
                            value="resilience" /><span>Resilience</span></label>
                    <label class="stat mental-column" style="grid-area: intellect"><span>Intellect</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="intellect"></dot-selector></label>
                    <label class="stat mental-column" style="grid-area: cunning"><span>Cunning</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="cunning"></dot-selector></label>
                    <label class="stat mental-column" style="grid-area: resolve"><span>Resolve</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="resolve"></dot-selector></label>
                    <div class="mental-column statbottom" style="grid-area: mental-end">&nbsp;</div>
                    <label class="stat physical-column" style="grid-area: might"><span>Might</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="might"></dot-selector></label>
                    <label class="stat physical-column" style="grid-area: dexterity"><span>Dexterity</span>
                        <dot-selector min="1" max="5" default="1" value="1" name="dexterity"></dot-selector></label>
                    <label class="stat physical-column" style="grid-area: stamina"><span>Stamina</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="stamina"></dot-selector></label>
                    <div class="physical-column statbottom" style="grid-area: physical-end">&nbsp;</div>
                    <label class="stat social-column" style="grid-area: presence"><span>Presence</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="presence"></dot-selector></label>
                    <label class="stat social-column" style="grid-area: manipulation"><span>Manipulation</span>
                        <dot-selector min="1" max="5" default="1" value="1" name="manipulation"></dot-selector></label>
                    <label class="stat social-column" style="grid-area: composure"><span>Composure</span> <dot-selector
                            min="1" max="5" default="1" value="1" name="composure"></dot-selector></label>
                    <div class="social-column statbottom" style="grid-area: social-end">&nbsp;</div>
                </div>
            </fieldset>
            <fieldset id="template-selection">
                <legend>Template</legend>
                <div class="talent">
                    <label for="moment">Moment of Inspiration</label>
                    <textarea name="moment" id="moment"></textarea>
                    <label for="assoc-attrib">Associated Attribute(s)</label>
                    <input type="text" name="assoc-attrib" id="assoc-attrib" />
                    <fieldset>
                        <legend>Gifts</legend>
                        <label for="advantage_gift_1">Origin</label>
                        <input type="text" name="gift" id="advantage_gift_1" />
                        <label for="advantage_gift_2">Role</label>
                        <input type="text" name="gift" id="advantage_gift_2" />
                        <label for="advantage_gift_3">Society</label>
                        <input type="text" name="gift" id="advantage_gift_3" />
                        <label for="advantage_gift_4">Bonus</label>
                        <input type="text" name="gift" id="advantage_gift_4" />
                    </fieldset>
                    <fieldset>
                        <legend>Facets</legend>
                        <label>Intuitive <dot-selector name="intuitive" max="5" min="0" default="0"
                                value="0"></dot-selector></label>
                        <label>Reflective <dot-selector name="reflective" max="5" min="0" default="0"
                                value="0"></dot-selector></label>
                        <label>Destructive <dot-selector name="destructive" max="5" min="0" default="0"
                                value="0"></dot-selector></label>
                        <hr>
                        <p>Inspiration <span id="inspiration-score"></span></p>
                    </fieldset>
                </div>
                <div class="psion"></div>
                <div class="psiad"></div>
                <div class="nova"></div>
                <div class="inspired">
                    <fieldset>
                        <legend>Type of Inspired</legend>
                        <label>Daredevil <input type="radio" name="inspired_type" id="daredevil"
                                value="daredevil" /></label>
                        <label>Mesmirist <input type="radio" name="inspired_type" id="mesmirist"
                                value="mesmirist" /></label>
                        <label>Stalwart <input type="radio" name="inspired_type" id="stalwart"
                                value="stalwart" /></label>
                    </fieldset>
                    <fieldset>
                        <legend>Facets</legend>
                    </fieldset>
                    <fieldset>
                        <legend>Gifts</legend>
                    </fieldset>
                </div>
            </fieldset>
            <fieldset id="extra-selection">
                <legend>Extras</legend>
            </fieldset>
            <fieldset id="character-sheet">
                <legend>Character sheet</legend>
                <p>[Show in New Window] [Show in Beside Column] [Show in this Tab]</p>
                <style>
                    input#talent:checked~form #character-sheet>div {
                        display: grid;
                        column-gap: 10px;
                        max-width: 950px;
                        margin: 0 auto;
                        grid-template-columns: 1fr 1fr;
                        grid-template-areas:
                            'title title'
                            'top1 top2'
                            'inspiration inspiration'
                            'skillsheader skillsheader'
                            'skillsc1 skillsc2'
                            'attrheader attrheader'
                            'attributes attributes'
                            'facethead injurhead'
                            'facets injuries'
                            'inspirhead injuries'
                            'inspirations injuries'
                            'edge skilltricks'
                            'gifthead pathehad'
                            'gifts pathconts'
                            'gifts aspirhead'
                            'gifts aspirations'
                    }

                    #character-sheet .title {
                        grid-area: title;
                        display: grid;
                        justify-content: center;
                    }

                    #character-sheet .top1>div>span+span {
                        text-decoration-line: underline;
                    }

                    #character-sheet .header {
                        display: grid;
                        background: var(--shade-color);
                        color: var(--shade-text);
                        font-weight: bold;
                        text-align: center;
                    }

                    #character-sheet .top1 {
                        display: grid;
                        grid-area: top1;
                    }

                    #character-sheet .top2 {
                        display: grid;
                        grid-area: top2;
                    }

                    #character-sheet .skillsheader {
                        grid-area: skillsheader;
                        font-size: 40px;
                    }

                    #character-sheet .attrheader {
                        grid-area: attrheader;
                        font-size: 40px;
                    }

                    #character-sheet .inspirhead {
                        grid-area: inspirhead;
                        font-size: 30px;
                    }

                    #character-sheet .facethead {
                        grid-area: facethead;
                        font-size: 30px;
                    }

                    #character-sheet .attributes {
                        grid-area: attributes;
                    }

                    #character-sheet .skillsc1 dot-label:nth-child(odd),
                    #character-sheet .skillsc2 dot-label:nth-child(odd) {
                        background: var(--table-alt-color);
                        color: var(--table-alt-text);
                    }

                    #character-sheet .skillsc1 {
                        display: grid;
                        grid-area: skillsc1;
                    }

                    #character-sheet .skillsc2 {
                        display: grid;
                        grid-area: skillsc2;
                    }

                    #character-sheet .injurhead {
                        grid-area: injurhead;
                        font-size: 30px;
                    }

                    #character-sheet .injuries {
                        display: grid;
                        grid-area: injuries;
                    }

                    #character-sheet .facets {
                        display: grid;
                        grid-area: facets;
                    }

                    #character-sheet .inspirations {
                        display: grid;
                        grid-area: inspirations;
                    }
                </style>
                <div>
                    <div class="title"
                        style="background: var(--title-img) no-repeat no-repeat center center;height: var(--title-img-height)">
                    </div>
                    <div class="top1">
                        <div data-field="name"><span>Name:</span> <span class="value">...</span></div>
                        <div data-field="player"><span>Player:</span> <span class="value">...</span></div>
                        <div data-field="concept"><span>Concept:</span> <span class="value">...</span></div>
                    </div>
                    <div class="top2">
                        <div><span>Origin Path:</span> <span>...</span></div>
                    </div>
                    <div class="skillsheader header">SKILLS</div>
                    <div class="skillsc1">xx</div>
                    <div class="skillsc2">yy</div>
                    <div class="attrheader header">ATTRIBUTES</div>
                    <div class="attributes">Mep</div>
                    <div class="injurhead header">INJURY CONDITIONS</div>
                    <div class="injuries">...</div>
                    <div class="facethead header">FACETS</div>
                    <div class="facets">...</div>
                    <div class="inspirhead header">INSPIRATIONS</div>
                    <div class="inspirations">...</div>
                </div>
                <div>
                    <div class="aspirheader">ASPIRATIONS</div>
                    <div data-field="short_aspiration_1"><span>Short aspiration 1</span> <span class="value">...</span>
                    </div>
                    <div data-field="short_aspiration_2"><span>Short aspiration 2</span> <span class="value">...</span>
                    </div>
                </div>
            </fieldset>
        </form>
        <style>
            footer {
                display: grid;
                grid-template-columns: 150px auto;
            }

            footer div p:first-child {
                margin-top: 0;
            }
        </style>
        <footer style="padding:10px;color:black;display:grid;">
            <div style="text-align:center;">
                <img src="https://vonexplaino.com/code/trinity-character-creator/img/OPP-Metal.1.png" /><br />2018
            </div>
            <div>
                <p>Used under license from Onyx Path Publishing, Inc. No part of this product may be reproduced without
                    the
                    permission of the Licensor.<br />

                </p>
                <p>Trinity Continuum, Trinity Continuum: Core, and Trinity Continuum: Aeon are trademarks of Onyx Path
                    Publishing. All rights reserved. All characters, names, places and text herein are copyrighted by
                    Onyx
                    Path Publishing.</p>
                <p>The mention of or reference to any company or product on this site is not a challenge to the
                    trademark or
                    copyright concerned.</p>
                <p>This project and all elements are fiction and intended for entertainment purposes only. Reader
                    discretion
                    is advised.</p>
                <p>Check out the Onyx Path at <a href="http://www.theonyxpath.com"
                        target="_blank">http://www.theonyxpath.com</a></p>
            </div>
            <nav>
                <a href="/">Creator homepage</a>
            </nav>
        </footer>
    </main>

    <script>
        class StandardPath {
            constructor() {
                this.name = "";
                this.skills = [
                    { "name": "", "dots": 0 },
                    { "name": "", "dots": 0 },
                    { "name": "", "dots": 0 }
                ];
                this.contacts = "";
                this.edges = [

                    { "name": "", "dots": 0 },
                    { "name": "", "dots": 0 },
                ];
                this.condition = "";
            }
        }
        class BaselineCharacter {
            constructor() {
                this.basics = {
                    "splat": "",
                    "name": "",
                    "player": "",
                    "concept": "",
                    "short_aspiration_1": "",
                    "short_aspiration_2": "",
                    "long_aspiration": "",
                }
                this.paths = [
                    { "name": "origin", "path": new StandardPath() },
                    { "name": "role", "path": new StandardPath() },
                    { "name": "society", "path": new StandardPath() }
                ]
                this.skills = {
                    "Aim": 0,
                    "Athletics": 0,
                    "Close Combat": 0,
                    "Command": 0,
                    "Culture": 0,
                    "Empathy": 0,
                    "Enigmas": 0,
                    "Humanities": 0,
                    "Integrity": 0,
                    "Larceny": 0,
                    "Medicine": 0,
                    "Persuasion": 0,
                    "Pilot": 0,
                    "Science": 0,
                    "Survival": 0,
                    "Technology": 0
                }
                this.attributes = {
                    "Mental": {
                        "Intellect": 1,
                        "Cunning": 1,
                        "Resolve": 1
                    },
                    "Physical": {
                        "Might": 1,
                        "Dexterity": 1,
                        "Stamina": 1
                    },
                    "Social": {
                        "Presence": 1,
                        "Manipulation": 1,
                        "Composure": 1
                    }
                }
                this.attribute_ranking = []
                this.favoured = ""
                this.updateSkillsLists()
                this.updateCharacter();
            }

            updateSkillsLists() {
                let skillsBar = Object.keys(this.skills).join("|")
                document.querySelectorAll("repeat-selector[name*='_skill_']").forEach((x) => {
                    x.setAttribute("options", skillsBar);
                });

                let skillBox = document.querySelector("#skill-selection div")
                skillBox.innerHTML = "";

                // Skill selection
                Object.keys(this.skills).forEach((x) => {
                    skillBox.innerHTML += `
                <div class="skill-and-dots">
                    <span>${x}</span>
                    <input type="text" name="speciality[${x}]" value="" />
                    <dot-selector name="skill_value[${x}]" max="5"></dot-selector>
                </div>`;
                });
                //Skills on character sheet
            }
            updateCharacter() {
                // Basics
                this.basics = {
                    "splat": document.querySelector("input[name='charclass']:checked")?.value ?? '',
                    "name": document.getElementById("name").value,
                    "player": document.getElementById("player").value,
                    "concept": document.getElementById("concept").value,
                    "short_aspiration_1": document.getElementById("aspiration_short_1").value,
                    "short_aspiration_2": document.getElementById("aspiration_short_2").value,
                    "long_aspiration": document.getElementById("aspiration_long").value,
                }
                // Skills (remember to add in all locations skills can change)
                Object.keys(this.skills).forEach((x) => {
                    this.skills[x] = document.querySelector(`dot-selector[name='skill_value[${x}]']`)?.value ?? 0;
                })
            }
            updateCharacterSheet() {
                // Basics
                Object.keys(this.basics).forEach((x) => {
                    let bob = document.querySelector(`*[data-field='${x}'] .value`);
                    if (bob) {
                        bob.innerText = this.basics[x];
                    }
                })

                // Skills
                const skillsKeys = Object.keys(this.skills),
                    halfWayIndex = Math.ceil(skillsKeys.length / 2),
                    leftSkills = skillsKeys.slice(0, halfWayIndex),
                    rightSkills = skillsKeys.slice(halfWayIndex),
                    leftColumn = document.querySelector('.skillsc1'),
                    rightColumn = document.querySelector('.skillsc2');
                leftColumn.innerHTML = "";
                leftSkills.forEach((x) => {
                    leftColumn.innerHTML += `<dot-label name="${x}" value="${this.skills[x]}" max="5"><span class="label"></span><span class="value"></span></dot-label>`;
                })
                rightColumn.innerHTML = "";
                rightSkills.forEach((x) => {
                    rightColumn.innerHTML += `<dot-label name="${x}" value="${this.skills[x]}" max="5"><span class="label"></span><span class="value"></span></dot-label>`;
                })
            }
        }
        class NovaCharacter extends BaselineCharacter {
            constructor() {
                super();
            }

        }
        class PsiCharacter extends BaselineCharacter {
            constructor() {
                super();
            }


        }
        class TalentCharacter extends BaselineCharacter {
            constructor() {
                super();
            }


        }
        var character = new BaselineCharacter();
        // Idea - don't have inherited classes, have extentions
        // just for the template/ final touches for each
    </script>
</body>

</html>